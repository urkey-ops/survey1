<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Feedback Survey</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type="radio"]:checked + label {
            transform: scale(1.1);
            box-shadow: 0 4px 14px rgba(0,0,0,0.1);
            border-color: #3b82f6; /* Tailwind's blue-500 */
        }
        /* Custom styling for the star rating to fill on hover and selection */
        .star-rating input[type="radio"] {
            display: none;
        }
        .star-rating label.star {
            cursor: pointer;
            color: #d1d5db; /* Tailwind's gray-400 */
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .star-rating input[type="radio"]:checked ~ label.star,
        .star-rating:hover input[type="radio"]:checked ~ label.star {
            color: #f59e0b; /* Tailwind's amber-500 */
        }
        .star-rating label.star:hover,
        .star-rating label.star:hover ~ label.star,
        .star-rating input[type="radio"]:checked ~ label.star:hover {
            color: #fcd34d; /* Tailwind's amber-300 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-lg mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Customer Feedback</h1>
        <p class="text-center text-gray-500 mb-6">We'd love to hear about your experience.</p>

        <!-- Status message container -->
        <div id="statusMessage" class="hidden text-sm"></div>

        <form id="surveyForm" class="space-y-6">

            <!-- Question 1: Text -->
            <div class="survey-page" data-page="0">
                <div id="rotatingQuestion" class="block text-gray-700 font-semibold mb-2"></div>
                <textarea
                    id="comments"
                    name="comments"
                    rows="4"
                    class="shadow-sm resize-none appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                    placeholder="Type your comments here..."
                    required
                ></textarea>
            </div>

            <!-- Question 2: Emoticon Rating -->
            <div class="survey-page hidden" data-page="1">
                <label class="block text-gray-700 font-semibold mb-2">2. Overall, how satisfied were you with your visit today?</label>
                <div class="flex justify-around items-center space-x-4">
                    <input type="radio" id="emojiSad" name="satisfaction" value="Sad" class="hidden">
                    <label for="emojiSad" class="flex flex-col items-center p-4 sm:p-6 bg-white border-2 border-transparent rounded-full hover:bg-gray-50 transition-all duration-300 cursor-pointer">
                        <span class="text-4xl sm:text-5xl">üòû</span>
                        <span class="mt-2 text-gray-500 text-xs sm:text-sm">Sad</span>
                    </label>

                    <input type="radio" id="emojiNeutral" name="satisfaction" value="Neutral" class="hidden">
                    <label for="emojiNeutral" class="flex flex-col items-center p-4 sm:p-6 bg-white border-2 border-transparent rounded-full hover:bg-gray-50 transition-all duration-300 cursor-pointer">
                        <span class="text-4xl sm:text-5xl">üòê</span>
                        <span class="mt-2 text-gray-500 text-xs sm:text-sm">Neutral</span>
                    </label>

                    <input type="radio" id="emojiHappy" name="satisfaction" value="Happy" class="hidden">
                    <label for="emojiHappy" class="flex flex-col items-center p-4 sm:p-6 bg-white border-2 border-transparent rounded-full hover:bg-gray-50 transition-all duration-300 cursor-pointer">
                        <span class="text-4xl sm:text-5xl">üòä</span>
                        <span class="mt-2 text-gray-500 text-xs sm:text-sm">Happy</span>
                    </label>
                </div>
            </div>

            <!-- Question 3: Linear Scale -->
            <div class="survey-page hidden" data-page="2">
                <label class="block text-gray-700 font-semibold mb-2">3. How would you rate the cleanliness of the facility?</label>
                <div class="flex justify-between items-center bg-gray-50 rounded-lg p-4">
                    <span class="text-xs text-gray-500">1 (Poor)</span>
                    <div class="flex space-x-2">
                        <input type="radio" id="clean1" name="cleanliness" value="1" class="hidden">
                        <label for="clean1" class="w-10 h-10 flex items-center justify-center text-sm font-medium bg-white rounded-full border border-gray-300 hover:bg-gray-100 transition-colors duration-200 cursor-pointer">1</label>
                        
                        <input type="radio" id="clean2" name="cleanliness" value="2" class="hidden">
                        <label for="clean2" class="w-10 h-10 flex items-center justify-center text-sm font-medium bg-white rounded-full border border-gray-300 hover:bg-gray-100 transition-colors duration-200 cursor-pointer">2</label>
                        
                        <input type="radio" id="clean3" name="cleanliness" value="3" class="hidden">
                        <label for="clean3" class="w-10 h-10 flex items-center justify-center text-sm font-medium bg-white rounded-full border border-gray-300 hover:bg-gray-100 transition-colors duration-200 cursor-pointer">3</label>
                        
                        <input type="radio" id="clean4" name="cleanliness" value="4" class="hidden">
                        <label for="clean4" class="w-10 h-10 flex items-center justify-center text-sm font-medium bg-white rounded-full border border-gray-300 hover:bg-gray-100 transition-colors duration-200 cursor-pointer">4</label>
                        
                        <input type="radio" id="clean5" name="cleanliness" value="5" class="hidden">
                        <label for="clean5" class="w-10 h-10 flex items-center justify-center text-sm font-medium bg-white rounded-full border border-gray-300 hover:bg-gray-100 transition-colors duration-200 cursor-pointer">5</label>
                    </div>
                    <span class="text-xs text-gray-500">5 (Excellent)</span>
                </div>
            </div>

            <!-- Question 4: Star Rating -->
            <div class="survey-page hidden" data-page="3">
                <label class="block text-gray-700 font-semibold mb-2">4. How friendly was the volunteer staff?</label>
                <div class="star-rating flex flex-row-reverse justify-end space-x-1 sm:space-x-2">
                    <input type="radio" id="star5" name="staff_friendliness" value="5">
                    <label for="star5" class="star">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 fill-current" viewBox="0 0 24 24"><path d="M12 17.27l6.18 3.73-1.64-7.03 5.46-4.73-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"/></svg>
                    </label>
                    <input type="radio" id="star4" name="staff_friendliness" value="4">
                    <label for="star4" class="star">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 fill-current" viewBox="0 0 24 24"><path d="M12 17.27l6.18 3.73-1.64-7.03 5.46-4.73-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"/></svg>
                    </label>
                    <input type="radio" id="star3" name="staff_friendliness" value="3">
                    <label for="star3" class="star">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 fill-current" viewBox="0 0 24 24"><path d="M12 17.27l6.18 3.73-1.64-7.03 5.46-4.73-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"/></svg>
                    </label>
                    <input type="radio" id="star2" name="staff_friendliness" value="2">
                    <label for="star2" class="star">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 fill-current" viewBox="0 0 24 24"><path d="M12 17.27l6.18 3.73-1.64-7.03 5.46-4.73-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"/></svg>
                    </label>
                    <input type="radio" id="star1" name="staff_friendliness" value="1">
                    <label for="star1" class="star">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 fill-current" viewBox="0 0 24 24"><path d="M12 17.27l6.18 3.73-1.64-7.03 5.46-4.73-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"/></svg>
                    </label>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div id="survey-navigation" class="flex justify-between items-center mt-6">
                <button
                    id="backButton"
                    type="button"
                    class="px-6 py-3 text-gray-600 font-bold bg-gray-200 rounded-lg shadow-md hover:bg-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-50 transition-colors"
                    style="visibility: hidden;"
                >
                    Back
                </button>
                <button
                    id="nextButton"
                    type="button"
                    class="px-6 py-3 text-white font-bold bg-blue-600 rounded-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-colors"
                >
                    Next
                </button>
            </div>
        </form>
    </div>

    <script>
        const form = document.getElementById('surveyForm');
        const statusMessage = document.getElementById('statusMessage');
        const surveyPages = document.querySelectorAll('.survey-page');
        const nextButton = document.getElementById('nextButton');
        const backButton = document.getElementById('backButton');
        const rotatingQuestionEl = document.getElementById('rotatingQuestion');

        const questions = [
            "1. What did you like about your visit today?",
            "1. What could we do better during your next visit?",
            "1. Do you have any general comments or suggestions?",
            "1. What was the most memorable part of your experience?"
        ];

        let currentPage = 0;
        let questionIndex = 0;

        function showPage(pageIndex) {
            surveyPages.forEach((page, index) => {
                page.classList.toggle('hidden', index !== pageIndex);
            });

            // Update navigation buttons
            backButton.style.visibility = pageIndex === 0 ? 'hidden' : 'visible';
            if (pageIndex === surveyPages.length - 1) {
                nextButton.textContent = 'Submit Survey';
                nextButton.type = 'submit';
            } else {
                nextButton.textContent = 'Next';
                nextButton.type = 'button';
            }
        }

        function validatePage(pageElement) {
            // Check for textarea validation
            const textarea = pageElement.querySelector('textarea');
            if (textarea && textarea.required && !textarea.value.trim()) {
                return false;
            }

            // Check for radio button validation
            const radioButtons = pageElement.querySelectorAll('input[type="radio"]');
            if (radioButtons.length > 0) {
                const isChecked = Array.from(radioButtons).some(radio => radio.checked);
                if (!isChecked) {
                    return false;
                }
            }
            return true;
        }

        let typingTimeout;
        let displayTimeout;

        function typeWriter(text, i, speed) {
            if (i < text.length) {
                rotatingQuestionEl.textContent += text.charAt(i);
                typingTimeout = setTimeout(() => typeWriter(text, i + 1, speed), speed);
            } else {
                // Once typing is complete, show the full question for 4 seconds
                displayTimeout = setTimeout(rotateQuestions, 4000);
            }
        }

        function rotateQuestions() {
            // Clear any previous timeouts to prevent overlap
            clearTimeout(typingTimeout);
            clearTimeout(displayTimeout);

            // Get the current question and reset the element's text
            const currentQuestion = questions[questionIndex];
            rotatingQuestionEl.textContent = "";
            questionIndex = (questionIndex + 1) % questions.length;
            
            // Start the typing effect
            typeWriter(currentQuestion, 0, 50); // 50ms per character
        }

        // Add event listeners for navigation
        nextButton.addEventListener('click', () => {
            const currentPageElement = surveyPages[currentPage];
            if (!validatePage(currentPageElement)) {
                statusMessage.textContent = 'Please answer the current question to continue.';
                statusMessage.className = 'block p-4 mb-4 rounded-xl text-center bg-red-100 text-red-700 font-medium';
                statusMessage.style.display = 'block';
                return;
            }
            statusMessage.style.display = 'none'; // Hide message on success

            if (currentPage < surveyPages.length - 1) {
                currentPage++;
                showPage(currentPage);
            }
        });

        backButton.addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                showPage(currentPage);
            }
        });

        // Handle the final form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Clear any previous messages
            statusMessage.style.display = 'none';

            // Collect data from all form fields
            const formData = new FormData(form);
            const data = {
                comments: formData.get('comments'),
                satisfaction: formData.get('satisfaction'),
                cleanliness: formData.get('cleanliness'),
                staff_friendliness: formData.get('staff_friendliness')
            };

            statusMessage.textContent = 'Submitting survey...';
            statusMessage.className = 'block p-4 mb-4 rounded-xl text-center bg-yellow-100 text-yellow-700 font-medium';
            statusMessage.style.display = 'block';

            try {
                const response = await fetch('https://survey1-iota.vercel.app/api/submit-survey', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    statusMessage.textContent = 'Survey submitted successfully! Thank you.';
                    statusMessage.className = 'block p-4 mb-4 rounded-xl text-center bg-green-100 text-green-700 font-medium';
                    form.reset();
                    currentPage = 0; // Reset survey to the first page
                    showPage(currentPage);
                } else {
                    statusMessage.textContent = 'Error submitting survey. Please try again.';
                    statusMessage.className = 'block p-4 mb-4 rounded-xl text-center bg-red-100 text-red-700 font-medium';
                }
            } catch (error) {
                console.error('Network or API Error:', error);
                statusMessage.textContent = 'Error: Could not connect to the server.';
                statusMessage.className = 'block p-4 mb-4 rounded-xl text-center bg-red-100 text-red-700 font-medium';
            }
        });

        // Initialize the survey on page load
        showPage(currentPage);
        rotateQuestions(); // Start the first question cycle
    </script>
</body>
</html>

//
